<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="icons/icon.png" />
    <title>Free PDF Splitter</title>

    <style>
      @import url("assets/Orbitron.css");

      * {
        box-sizing: border-box;
      }

      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #0f0f20;
        font-family: "Orbitron", sans-serif;
        color: #00fff7;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .container {
        background: #111122;
        border: 2px solid #00fff7;
        border-radius: 12px;
        padding: 2.5rem 2rem 3rem;
        width: 420px;
        max-width: 95%;
        box-shadow: 0 0 30px #00fff7;
        display: flex;
        flex-direction: column;
        align-items: center;
        animation: fadeIn 0.6s ease;
      }

      input[type="number"],
      input[type="file"],
      input[type="text"] {
        width: 100%;
        padding: 0.6rem 1rem;
        font-size: 1rem;
        border-radius: 8px;
        border: 1.5px solid #00fff7;
        background: #0f0f20;
        color: #00fff7;
        margin-bottom: 1rem;
        box-shadow: 0 0 15px #00fff7 inset;
        cursor: pointer;
      }

      input[type="text"] {
        cursor: text !important;
      }

      button,
      .button {
        width: 100%;
        padding: 0.75rem 1rem;
        font-size: 1.1rem;
        background: #00fff7;
        border: none;
        color: #0f0f20;
        font-weight: 700;
        border-radius: 8px;
        cursor: pointer;
        box-shadow: 0 0 20px #00fff7;
        transition: background 0.3s ease;
        margin-top: 0.5rem;
      }

      button:hover,
      .button:hover {
        background: #00c6b6;
      }

      a.button {
        text-align: center;
        text-decoration: none;
        color: #0f0f20;
      }

      a:hover {
        color: #00fff7;
        text-shadow: 0 0 8px #00fff7;
      }

      #pdfForm {
        width: 100%;
        text-align: left;
        margin-top: 1rem;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @media (max-width: 400px) {
        .container {
          font-size: 12px;
          padding: 5px;
          width: 100%;
        }
      }

      @media (max-width: 240px) {
        .container {
          font-size: 10px;
          padding: 3px;
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div
      id="overlay"
      style="
        width: 100%;
        height: 100%;
        z-index: 1202131321;
        background-color: #ffffff;
        position: fixed;
        top: 0;
        bottom: 0;
        opacity: 0.6;
        justify-content: center;
        align-items: center;
        align-content: center;
        text-align: center;
        flex-direction: column;
        color: black;
        display: none;
        transition: 0.5;
        font-size: 2rem;
      "
    >
      Drop PDF File here
    </div>
    <div class="container">
      <h1>Split A PDF Into Parts</h1>

      <form id="pdfForm"></form>

      <div style="margin-top: 1rem; width: 100%; text-align: left">
        <label
          ><input type="radio" name="mode" value="manual" checked id="manual" />
          Manual ranges</label
        ><br />
        <label
          ><input type="radio" name="mode" value="auto" id="automatic" /> Auto
          split into parts</label
        >
      </div>

      <div id="autoSplitBox" style="display: none; margin-top: 0.5rem">
        <label>Number of parts:</label>
        <input type="number" id="partCount" min="2" max="100" value="2" />
      </div>

      <button id="splitBtn">Split PDF</button>

      <a class="button" href="imageconverter.html" target="_blank"
        >Try Image Converter</a
      >
      <a class="button" href="pdfmerger.html" target="_blank">Try PDF Merger</a>
      <a
        class="button"
        href="mailto:moaz96526@gmail.com?subject=New%20Suggestion%20For%20The%20Image%20Converter"
        target="_blank"
        >Suggestions</a
      >
    </div>

    <!-- Load PDF-lib -->
    <script src="assets/pdf-lib/dist/pdf-lib.min.js"></script>

    <script>
      const overlay = document.getElementById("overlay");
      const { PDFDocument } = PDFLib;
      const splitBtn = document.getElementById("splitBtn");
      const pdfForm = document.getElementById("pdfForm");
      const autoRadio = document.getElementById("automatic");
      const manualRadio = document.getElementById("manual");
      const autoSplitBox = document.getElementById("autoSplitBox");

      let dropZone = null;
      let pdfFileInput = null;
      let rangeInput = null;
      let droppedFile = null;

      // -------------------- Mode toggle --------------------
      function toggleMode() {
        const manual = manualRadio.checked;
        if (rangeInput) rangeInput.style.display = manual ? "block" : "none";
        const label = document.getElementById("hiddenLabel");
        if (label) label.style.display = manual ? "block" : "none";
        autoSplitBox.style.display = manual ? "none" : "block";
      }

      autoRadio.addEventListener("change", toggleMode);
      manualRadio.addEventListener("change", toggleMode);

      // -------------------- Setup PDF input --------------------
      function setupPDFInput() {
        pdfForm.innerHTML = "";

        // Hidden file input
        pdfFileInput = document.createElement("input");
        pdfFileInput.type = "file";
        pdfFileInput.accept = "application/pdf";
        pdfFileInput.style.display = "none";
        pdfForm.appendChild(pdfFileInput);

        // Drop zone
        dropZone = document.createElement("div");
        dropZone.textContent = "Click or drag a PDF file here";
        Object.assign(dropZone.style, {
          width: "100%",
          padding: "1rem",
          margin: "1rem 0",
          textAlign: "center",
          border: "2px solid #00ffff",
          borderRadius: "8px",
          background: "#0f0f20",
          color: "#00fff7",
          cursor: "pointer",
          transition: "all 0.3s ease",
          boxShadow: "0 0 15px #00fff7 inset",
        });
        pdfForm.appendChild(dropZone);

        // Click â†’ open file picker
        dropZone.addEventListener("click", () => pdfFileInput.click());

        // File input change
        pdfFileInput.addEventListener("change", () => {
          if (pdfFileInput.files.length > 0) {
            droppedFile = pdfFileInput.files[0];
            dropZone.textContent = droppedFile.name;
          }
        });

        // Drag events
        document.addEventListener("dragover", (e) => {
          e.preventDefault();
          overlay.style.display = "flex";
        });

        overlay.addEventListener("dragleave", () => {
          overlay.style.display = "none";
          dropZone.textContent = droppedFile
            ? droppedFile.name
            : "Click or drag a PDF file here";
        });
        overlay.addEventListener("drop", (e) => {
          e.preventDefault();
          const file = e.dataTransfer.files[0];
          if (file && file.type === "application/pdf") {
            droppedFile = file;
            dropZone.textContent = file.name;
          } else {
            alert("Please drop a valid PDF file.");
            overlay.style.display = "none";
          }
          overlay.style.display = "none";
        });

        // Manual range input
        const rangeLabel = document.createElement("label");
        rangeLabel.id = "hiddenLabel";
        rangeLabel.textContent = "Page ranges (e.g. 1-2,3-4,7-9):";
        pdfForm.appendChild(rangeLabel);

        rangeInput = document.createElement("input");
        rangeInput.type = "text";
        rangeInput.id = "rangeInput";
        rangeInput.placeholder = "e.g. 1-2,3-4,7-9";
        pdfForm.appendChild(rangeInput);

        toggleMode();
      }

      // -------------------- Split PDF --------------------
      splitBtn.addEventListener("click", async () => {
        const file = droppedFile || (pdfFileInput && pdfFileInput.files[0]);
        if (!file) return alert("Please upload or drop a PDF first.");

        splitBtn.disabled = true;
        splitBtn.textContent = "Splitting...";

        try {
          const originalName = file.name.replace(/\.[^/.]+$/, "");
          const arrayBuffer = await file.arrayBuffer();
          const originalPdf = await PDFDocument.load(arrayBuffer);
          const totalPages = originalPdf.getPageCount();
          const mode = document.querySelector(
            'input[name="mode"]:checked'
          ).value;

          if (mode === "manual") {
            if (!rangeInput.value)
              return alert("Please enter at least one range.");
            const ranges = rangeInput.value.split(",").map((r) => r.trim());

            for (const range of ranges) {
              if (!range) continue;
              let start, end;
              if (range.includes("-"))
                [start, end] = range
                  .split("-")
                  .map((n) => parseInt(n.trim(), 10));
              else start = end = parseInt(range, 10);

              if (
                isNaN(start) ||
                isNaN(end) ||
                start < 1 ||
                end > totalPages ||
                start > end
              ) {
                console.warn(`Skipping invalid range: ${range}`);
                continue;
              }

              const newPdf = await PDFDocument.create();
              for (let p = start - 1; p < end; p++) {
                const [copiedPage] = await newPdf.copyPages(originalPdf, [p]);
                newPdf.addPage(copiedPage);
              }

              const pdfBytes = await newPdf.save();
              const link = document.createElement("a");
              link.href = URL.createObjectURL(
                new Blob([pdfBytes], { type: "application/pdf" })
              );
              link.download = `${originalName}-part-${start}-${end}.pdf`;
              link.click();
              URL.revokeObjectURL(link.href);
            }
          } else if (mode === "auto") {
            const partCount = parseInt(
              document.getElementById("partCount").value,
              10
            );
            if (isNaN(partCount) || partCount < 2)
              return alert("Enter a valid number of parts (>=2).");

            const pagesPerPart = Math.ceil(totalPages / partCount);
            let start = 1;

            for (let i = 1; i <= partCount; i++) {
              const end = Math.min(start + pagesPerPart - 1, totalPages);
              const newPdf = await PDFDocument.create();
              for (let p = start - 1; p < end; p++) {
                const [copiedPage] = await newPdf.copyPages(originalPdf, [p]);
                newPdf.addPage(copiedPage);
              }

              const pdfBytes = await newPdf.save();
              const link = document.createElement("a");
              link.href = URL.createObjectURL(
                new Blob([pdfBytes], { type: "application/pdf" })
              );
              link.download = `${originalName}-part-${i}.pdf`;
              link.click();
              URL.revokeObjectURL(link.href);

              start = end + 1;
              if (start > totalPages) break;
            }
          }

          alert("PDF split completed!");
        } catch (err) {
          console.error("Split error:", err);
          alert("An error occurred while splitting. See console for details.");
        } finally {
          splitBtn.disabled = false;
          splitBtn.textContent = "Split PDF";
        }
      });

      // -------------------- Initialize --------------------
      window.onload = setupPDFInput;
    </script>
  </body>
</html>
